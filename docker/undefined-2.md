---
description: 그림과 실습으로 배우는 도커 & 쿠버네티스
---

# 도커의 동작 원리

## <도커의 동작 원리>

## 도커의 구조

* 물리 서버가 있고, 물리 서버에서 동작하는 운영체제가 있는데 이는 일반적인 서버와 다르지 않음
* 일반적인 서버라면 이 운영체제 위에 프로그램이나 데이터가 올라가겠지만, 도커를 사용하는 경우 운영체제 위에 도커 엔진이 동작하고 그 위에서 컨테이너가 동작
* 프로그램이나 데이터(일부)는 컨테이너 안에 위치

### 컨테이너 안에는 운영체제 '비슷한 것'이 들어있다

* 모든 컨테이너에는 '리눅스 운영체제 비슷한 무언가'가 들어있음
* 빈 컨테이너라고 해도 정말로 텅 빈 것은 아님
* 도커 엔진 아래는 실제 운영체제가 동작함 (주의)

### 운영체제가 하는 일은 뭘까?

* 운영체제는 소프트웨어나 프로그램의 명령을 하드웨어에 전달하는 역할을 함
* 컴퓨터는 구체적으로 지시하지 못하면 이해하지 못하는데, 프로그램에 적힌 것은 "귤을 먹어라" 정도의 수준이며, 이보다 자세한 사항은 운영체제가 풀어서 하드웨어에 지시함
* 즉, 운영체제가 번역해서 지시하는 것과 비슷함
* 도커 엔진 아래에도 운영체제가 있는데, 컨테이너 속에 또 리눅스 운영체제 비슷한 것이 있음
* 이 점이 도커의 가장 큰 특징 중 하나
* 본래 운영체제는 '커널' 이라는 부분과 '그 외 주변 부분'으로 구성되는데, 주변 부분이 프로그램의 연락 내용을 커널에 전달하고 커널이 하드웨어를 다룸
* 개인적으로 주변 부분에서 명령을 하고 이보다 자세한 사항을 커널에서 지시한다고 생각하면 된다고 생각함
* 도커에서는 컨테이너가 완전히 분리되어 있으므로 밑바탕이 되는 리눅스 운영체제의 주변 부분이 컨테이너 속 프로그램의 명령을 전달받을 수가 없음
* 따라서, 컨테이너 속에 운영체제의 주변 부분이 들어 있어 프로그램의 명령을 전달받고 이를 밑바탕이 되는 커널에 전달하는 구조로 되어있음
* 도커(소프트웨어 -> 리눅스의 주변 부분) -> 도커 엔진 -> 커널 -> 하드웨어 순
* 컨테이너가 외부와 완전히 분리되어 있으므로 리눅스의 주변 부분이 따로 들어있다고 이해하면 됨
* 왜 비슷한 것이라고 했냐면, 주변 부분만 따로 들어있기 때문에(커널은 없음) 그렇게 표현
* 그렇다면 왜 전체를 넣지 않는가? 주변 부분만 컨테이너에 넣고 커널은 밑바탕에 있는 것을 빌려쓰기 때문에 도커의 가장 큰 특징인 '가벼움'을 얻을 수 있기 때문

## 도커는 기본적으로 '리눅스용'

* 도커는 기본적으로 리눅스 운영체제에서만 동작하는데, 이유는 밑바탕에서 리눅스 운영체제가 동작하는 것을 전제로 하는 구조로 되어있기 때문
* 그렇기에 컨테이너 안에 들어있는 주변 부분도 리눅스 운영체제의 주변 부분이 됨
* 소프트웨어 역시 리눅스용 소프트웨어로, 윈도우나 맥용 소프트웨어는 동작하지 않음
* 즉, 도커는 리눅스 컴퓨터에 독립된 격리 환경을 만들고, 리눅스에서만 동작하고, 컨테이너에서 동작할 프로그램도 리눅스용 프로그램

### 윈도우나 맥에서 도커 구동하기

* 위와 같은 내용만 보면 윈도우나 맥에서는 도커를 사용할 수 없어야 함
* 하지만 실제로는 윈도우나 맥에서 도커를 사용할 수 있는데 이런 경우는 VirtualBox나 VMware 같은 가상환경 위에 리눅스 운영체제를 설치하고 그 위에서 도커를 실행하는 경우가 첫번째, 두번째는 윈도우용 또는 맥용 도커 테스크톱 처럼 도커를 실행하는 데 필요한 리눅스 운영체제를 포함하는 패키지를 설치해 사용하는 경우임
* 간단히 말해서, 윈도우나 맥 위에 리눅스 운영체제를 끌어들여 도커를 실행하는 것
* 이처럼 도커를 사용하기 위해선 어떤 형태로든 리눅스 운영체제를 갖춰야만 함

## <도커 허브와 이미지, 그리고 컨테이너>

## 이미지와 컨테이너

* 컨테이너를 생성하려면 먼저 이미지를 만들어야함
* 이미지는 컨테이너를 찍어내는 빵틀과 같은 것으로 컨테이너의 설계도 역할을 함

### 이미지는 금형과 같다

* 로봇 장난감을 원하는 아이에게 로봇 틀을 주는 것은 소용 없음
* 즉, 이미지 또한 이미지 자체로는 의미가 없고 이미지는 컨테이너를 만드는 데 사용함
* 실제로 사용하는 것은 컨테이너로, 이미지를 그대로 사용하는 일은 없음
* 이미지는 하나만 있어도 동일한 컨테이너를 여러 개 만들 수 있음

### 컨테이너로도 이미지를 만들 수 있다

* 이미지로만 컨테이너를 만드는 것이 아니라 컨테이너로도 이미지를 만들 수 있음
* 컨테이너로 이미지를 만드는 것은 이미 만든 컨테이너에 손을 대서 컨테이너의 틀을 새로이 만드는 과정
* 즉, 완제품을 수정해서 수정된 제품으로 틀을 새로 만든다고 생각하면 됨
* 개조된 컨테이너로부터 이미지를 만들고 나면 새로 만든 이미지를 사용해 개조된 컨테이너를 여러개 만들 수 있음

### 도커 엔진 간에 이동이 가능

* 동일한 컨테이너를 여러 개 만들지 않아도 이러한 특성을 이용해 다른 물리 서버에 설치된 도커 엔진으로 컨테이너를 이동시킬 수 있음
* 컨테이너는 도커 엔진만 설치되어 있으면 구동이 가능하므로 다른 서버나 컴퓨터에 도커 엔진을 설치하고 새로운 도커 엔진에 이미지를 이용해 똑같은 컨테이너를 생성하면 됨
* 컨테이너가 실제로 이동하는 것은 아니지만 이미지를 통해 컨테이너가 이동한 것과 같은 효과를 얻을 수 있음

## 도커 허브와 도커 이미지

* 이미지는 주로 도커 허브에서 구하게 됨
* 도커 허브는 공식적으로 운영되는 도커 레지스트리(도커 이미지를 배포하는 서비스)의 이름
* 공개된 컨테이너 이미지가 모여있는 곳으로, 원하는 컨테이너의 이미지를 내려받을 수 있음

### 안전한 컨테이너 이미지 고르는 법

* 공식 이미지를 사용
* 커스텀 이미지를 직접 만들어 사용

### 다양한 형태로 조합이 가능한 컨테이너

* 컨테이너는 이미지의 선택 외에도 다양한 조합을 고려해야 함
* 도커를 사용할 때 원칙 중 하나로, 한 컨테이너에 한 프로그램 이란 것이 있음
* 말 그대로 하나의 프로그램만 담긴 컨테이너를 사용한다는 의미로, 보안 및 유지 관리 측면에서 유리하기 때문에 많이 사용되는 정책임

## <도커 컨테이너의 생애 주기와 데이터 저장>

## 도커 컨테이너는 '쓰고 버리는' 일회용품

* 컨테이너는 쉽게 만들 수 있으므로, 컨테이너 하나를 업데이트하면서 계속 사용하기보다는 업데이트된 소프트웨어가 들어있는 새로운 컨테이너를 사용하는 것이 좋음
* 즉, 새로운 버전이 나오면 새로운 컨테이너로 갈아타는 것
* 컨테이너는 일반적으로 여러 개를 동시 가동하는 상황을 전제로 하기 때문에 여러 개의 컨테이너를 하나하나 업데이트하려면 비용이 많이 들기 때문
* 이와 같이 컨테이너를 만들고, 실행하고, 종료하고, 폐기한 다음, 다시 컨테이너를 만드는 일련의 과정을 컨테이너의 생애주기라 함

## 데이터 저장

* 컨테이너를 폐기한다면 안에 들어있던 데이터는 어떻게 할까?
* 당연히 사라짐
* 이 경우 굉장히 곤란해지기 때문에, 이를 방지하기 위해 보통 도커가 설치된 물리적 서버(호스트)의 디스크를 마운트해 이 디스크에 데이터를 저장
* 마운트는 디스크를 연결해 데이터를 기록할 수 있도록 한 상태를 의미
* 예로, 컴퓨터에 외장 USB 메모리나 HDD를 연결하는 것을 생각하면 됨
* 이런 방법으로 데이터는 컨테이너 외부에 안전하게 저장해 사라지지 않고, 도커 엔진 자체에 무슨 일이 생기더라도 데이터는 그대로 보존됨
* PC가 망가질 때를 대비해 외부에 데이터를 저장하는 것과 같은 이치
* 이렇게 외부에 저장하면 다른 컨테이너와 데이터를 공유할 수도 있어서 매우 편리함

## <도커의 장점과 단점>

## 도커의 구조와 성질 및 장단점

### '환경을 격리할 수 있다'는 것이 핵심

* 독립된 환경 덕분에 여러 개의 컨테이너를 띄울 수 있고, 똑같은 애플리케이션도 여러 개 띄울 수 있음
* 그 중 일부를 교체하거나 수정 가능
* 이미지를 만들 수 있고, 만든 이미지를 도커 허브에서 배포할 수 있음
* 이미지를 내려받기만 하면 컨테이너를 사용할 수 있고 구축 작업이 간단해져 교체가 쉽고 업데이트가 쉬움
* 컨테이너에 커널을 포함시킬 필요가 없어 가벼움

## 도커의 장점과 단점

### 도커의 장점

* 한 대의 물리 서버에 여러 대의 서버를 띄울 수 있음
* 서버 관리가 용이
* 서버를 다루기 쉬움

### 도커의 단점

* 리눅스용 소프트웨어만 지원함
* 물리 서버 한 대에 여러 대의 서버를 띄우는 형태이므로 호스트 서버에 문제가 생기면 모든 컨테이너에 영향이 미침
* 컨테이너를 여러 개 사용하는 형태를 가정하므로 컨테이너 하나를 장기간에 걸쳐 사용할 때는 그리 큰 장점을 느끼기 어려움
* 도커를 사용하려면 도커 엔진을 반드시 구동해야하는데, 하나만 사용한다면 도커 엔진이 단순한 오버헤드에 그치기 때문

## 도커의 주 용도

### 팀원 모두에게 동일한 개발환경 제공(=동일한 환경을 여러 개 만들기)

* 프로젝트 별로 컨테이너를 따로 사용할 수 있음
* 컨테이너는 운영환경과 완전히 동일하게 생성되므로 개발 환경과 운영 환경의 차이가 근본적으로 사라짐
* 보통 운영 서버 구축을 담당하는 사람이 컨테이너를 만들어 팀원에게 배포

### 새로운 버전의 테스트(=격리된 환경을 이용)

* 운영체제나 라이브러리 등의 새로운 버전을 먼저 개발환경에서 테스트한 후 운영환경에 적용할 때도 컨테이너를 활용 가능

### 동일한 서버가 여러 대 필요한 경우(=컨테이너 밖과 독립된 성질을 이용)

* 동일한 서버가 여러 대 필요한 경우에도 컨테이너를 이용해 한 대의 물리 서버에 똑같은 서버를 여러 개 만들 수 있음
