---
description: 그림과 실습으로 배우는 도커 & 쿠버네티스
---

# 도커 엔진 시작/종료 하기

## <도커 엔진 시작하기/종료하기>

## 도커 엔진을 시작/종료하는 방법

* 도커 엔진은 컨테이너를 실행 중이 아니라면 컴퓨터의 리소스를 거의 차지하지 않으므로 문제는 없음
* 도커 엔진은 컴퓨터를 켰을 때 함께 자동으로 실행할 수 있지만 컨테이너는 아님
* 컨테이너는 실행시킬 스크립트가 따로 필요함(정전으로 서버가 꺼졌을 경우)

## <컨테이너의 기본적인 사용 방법>

## 컨테이너 사용의 기본은 도커 명령어

* 컨테이너를 다루는 모든 명령은 docker 명령어로 시작함

### 명령어와 대상

* docker 명령어 뒤에 오는 '무엇을' '어떻게'에 해당하는 부분을 커맨드라고 함
* 커맨드는 상위와 하위 커맨드로 나뉘어지는데, 상위 커맨드는 '무엇을', 하위 커맨드는 '어떻게'에 해당하는 내용을 담당
* 또한 '대상'에는 컨테이너명 또는 이미지명 등 구체적인 이름이 들어감
* 즉, docker '무엇을' '어떻게' '대상' 과 같이 이루어짐 == docker 커맨드 대상

### 옵션과 인자

* 명령어의 기본적인 형태는 docker \[커맨드] \[대상] 이지만 옵션과 인자라는 추가 정보도 붙음
* 예로, docker container run -d penguin --mode=1 에서 옵션은 -d(백그라운드 실행), 인자는 --mode=1(모드 1로 실행)

## 기본적인 명령어 - 정리

* 옵션과 인자가 붙은 지금 명령어의 형태는 다음과 같이 볼 수 있음
* docker \[커맨드] (옵션) \[대상] (인자)

### 커맨드(상위 / 하위)

* start나 run처럼 container를 붙이지 않아도 실행가능한 명령어가 있음
* docker container run -> docker run (= docker container run)

### 옵션

* 커맨드에 세세한 설정을 지정하는 용도
* 백그라운드로 실행할 때는 -d, 키보드를 통해 조작하고 싶다면 -i, -t 등 커맨드의 실행방법이나 커맨드에 전달할 값을 지정함
* 참고로 -d와 같이 -를 하나만 쓰는 옵션들은 -dit 와 같이 모아서 사용할 수 있음
* \--name과 같이 커맨드에 전달할 값을 지정하는 옵션은 뒤에 값을 지정함 (= --name penguin)

### 대상

* 커맨드와 다르게 구체적인 이름 지정

### 인자

* 대상에 전달할 값을 지정하는데, 포트 번호 또는 문자 코드 등을 전달할 수 있음
* 단, 인자를 지정하는 경우는 많지 않음

## 커맨드 조작 관련

### 볼륨 조작 관련 커맨드(상위 커맨드 volume)

* 볼륨은 컨테이너에 마운트 가능한 스토리지
* docker volume 하위\_커맨드 옵션
* create, inspect, ls, prune, rm

### 네트워크 조작 관련 커맨드(상위 커맨드 network)

* 도커 네트워크란 도커 요소 간의 통신에 사용하는 가상 네트워크를 가리킴
* docker network 하위\_커맨드 옵션
* connect, disconnect, create, inspect, ls, prune, rm

### 그 밖의 상위 커맨드

* 이들 중 대부분은 도커 스웜과 관련된 커맨드
* 도커 스웜은 컨테이너 오케스트레이션 기능을 제공하는데 쿠버네티스와는 별도

## <컨테이너의 생성과 삭제, 실행, 정지>

## docker run 커맨드와 docker stop, docker rm 커맨드

* 컨테이너 실행 시 docker run(docker container run) 커맨드를 사용
* 이는 도커 컨테이너를 생성하고 실행하는 기능을 하는데, 컨테이너를 생성하는데는 이미지가 필요하다고 알고 있으니, 이미지가 없으면 이미지도 내려받는 기능을 겸함
* 도커 커맨드 중에는 docker create, docker start, docker pull 등 커맨드가 따로 존재하지만 보통 이들의 기능을 한번에 수행하는 docker run(docker container run)을 사용하는 것이 일반적임
* 다만, 이미 이미지를 내려받아 컨테이너를 생성한 상태에서는 docker run 보다 docker start를 일반적으로 사용

### 컨테이너 생성 및 실행 커맨드 docker run(docker container run)

* 컨테이너를 생성해 실행하는 커맨드로 docker image pull, docker container create, docker container start의 기능을 하나로 합친것과 같음
* 컨테이너의 이름은 --name 옵션, 포트 번호는 -p, 볼륨 마운트는 -v, 컨테이너를 연결할 네트워크는 --net 옵션 등을 사용가능

### 컨테이너 정지 커맨드 docker stop (docker container stop)

* 컨테이너 삭제 전에 먼저 반드시 정지시켜야 함

### 컨테이너 삭제 커맨드 docker rm (docker container rm)

* 컨테이너 삭제 커맨드로, 정지 상태인 컨테이너를 대상으로 함

## docker ps 커맨드

* 컨테이너의 생애주기를 관장하는 커맨드 외에 자주 사용하는 커맨드로 docker ps (docker container ls) 임
* 컨테이너의 목록을 출력하는 기능으로, docker ps 에 -a 옵션을 추가하면 현재 존재하는 컨테이너 목록을 출력함

## <컨테이너의 통신>

## 아파치란?

* 아파치는 웹 서버 기능을 제공하는 소프트웨어
* 쉽게 설명해서, 아파치가 동작중인 서버에 파일을 두면 이 파일을 웹 사이트 형태로 볼 수 있음
* 하지만, 앞과 똑같은 명령어로는 웹 사이트 동작을 확인할 수 없는데, 컨테이너가 외부에서 접근이 불가능한 상태로 실행되기 때문
* 웹 브라우저를 통해 컨테이너에 접근이 가능하게하려면 컨테이너를 실행할 때 설정이 필요한데, 컨테이너를 생성한 후에는 기본적으로 변경할 수 없음
* 따라서 docker run 에 옵션으로 설정

## 컨테이너와 통신하려면

* 웹 브라우저를 통해 컨테이너에 접근하려면 외부와 접속하기 위한 설정이 필요한데, 이를 위해 포트를 설정함
* 포트는 통신 내용이 드나드는 통로를 의미함
* 아파치는 서버에서 정해둔 80번 포트에서 웹 사이트에 대한 접근을 기다리다가 사용자가 이 포트를 통해 접근해오면 요청에 따라 웹사이트의 페이지를 제공함
* 하지만 컨테이너 속에서 실행 중인 아파치는 외부와 직접 연결되지 않았기 때문에 외부에서 접근할 수 없음
* 즉, 포트를 지켜보며 외부의 접근을 기다리지만 외부와 연결된 상태는 아님
* 그래서 컨테이너를 실행 중인 물리적 컴퓨터가 외부의 접근을 대신 받아 전달해줌
* 좀 더 구체적으로 설명하면, 컨테이너를 실행중인 컴퓨터(호스트)의 8080번 포트와 컨테이너의 80번 포트를 연결하는데 이 설정이 -p 옵션이며, 그 뒤로 호스트 포트번호와 컨테이너 포트번호를 콜론으로 연결해 함께 기재
* \-p 호스트\_포트\_번호 : 컨테이너\_포트\_번호 / -p 8080:80
* 컨테이너를 사용하면 여러 개의 웹서버를 함께 실행할 수 있는데, 이 경우 호스트 포트 번호를 모두 같은 것으로 사용하면 어떤 컨테이너로 가야할 요청인지 구분할 수 없기 때문에 호스트 포트 번호를 다르게 설정함

## <컨테이너 생성에 익숙해지기>

## 다양한 유형의 컨테이너

### 리눅스 운영체제가 담긴 컨테이너

* 컨테이너 속 파일 시스템을 다루는 것을 전제로 하므로 인자로 셸 명령어를 지정
* \-d 없이 -it 옵션만 사용

### 웹서버/ 데이터베이스 서버용 컨테이너

* 웹 서버 소프트웨어로는 아파치 외에도 nginx가 유명함
* 웹 서버는 통신이 전제가 되므로 옵션을 통해 포트 번호를 지정해야 함
* 또한 데이터베이스 서버는 MySQL 외에 PostgreSQL이나 MariaDB도 유명함
* 데이터베이스 관리 소프트웨어에는 기본적으로 루트 패스워드를 반드시 지정해야 함

## <이미지 삭제>

## 이미지 삭제

* 컨테이너를 여러 번 만들다 보면 컨테이너를 삭제해도 이미지는 그대로 남아 쌓이는 문제가 발생
* 이미지가 늘어나면 스토리지 용량을 압박하게 되므로 필요없어진 이미지는 그때그때 삭제하도록 함
* 해당 이미지로 실행한 컨테이너가 남아있으면 이미지를 삭제할 수 없으므로 docker ps -a와 같이 컨테이너 목록을 출력해 확인하고 컨테이너를 먼저 종료 및 삭제 후 이미지를 삭제

## docker image rm 커맨드

* docker image rm 커맨드를 사용해 이미지를 삭제함
* 이 커맨드는 docker rm 과 같이 커맨드를 생략할 수 없는데, docker rm 은 docker container rm 이라서 이미지가 아닌 컨테이너가 삭제되기 때문

### 이미지를 삭제하는 커맨드 docker image rm

* 여러 개의 이미지를 지정하는 경우 docker image rm 이미지\_이름 이미지\_이름 ... 과 같이 지정

## docker image ls 커맨드

* docker ps 는 docker container ls와 같은 커맨드로 image ls와는 다른 커맨드
* 이미지는 컨테이너와 다르게 실행 중, 종료 등 상태를 가질 수 없기 때문에 -a 옵션은 사용하지 못함
